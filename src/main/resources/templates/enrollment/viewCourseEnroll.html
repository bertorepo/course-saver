<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<title>View Course Enroll</title>
	<link rel="stylesheet" type="text/css" href="../css/app/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	
</head>

<body>
	<div th:insert="fragments/general.html :: header"> </div>
	
	<div class="container mt-5">
		<form class="form-horizontal" action="#" th:action="@{/enrollment/viewCourseEnroll}" th:object="${viewCourseEnroll}" method="get">
			<h3><i class="fa fa-calendar-o"></i> Select Training Period</h3>
			<hr>
			<div class="card">
				<div class="card-body">
					<div class="form-group row">
						<label class="col-lg-2 col-form-label">From Date</label>
						<div class="col-lg-3">
							<input type="datetime" class="form-control" name="fromDateTime" id="" th:field="*{fromDateTime}">
						</div>
						<label class="col-lg-2 col-form-label">To Date</label>
						<div class="col-lg-3">
							<input type="datetime" class="form-control" name="toDateTime" id="" th:field="*{toDateTime}">
						</div>
					</div>
					<div class="float-right">
						<input type="submit" class="btn btn-success" value="Submit">
					</div>
				</div>
			</div>
		</form>
		<!--Error Modal-->
		<div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm text-center">
				<div class="modal-content">
					<div class="modal-header alert-danger">
						<h5 class="modal-title"></h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="form-group row">
							<label class="col-lg-12 col-form-label" id="message"></label>
						</div>	
					</div>
				</div>
			</div>
		</div>
		<!--Error Modal End-->
		
		<!--Confirmation Modal-->
		<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm text-center">
				<div class="modal-content">
					<div class="modal-header alert-danger">
						<h5 class="modal-title">Confirmation</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="form-group row">
							<label class="col-lg-12 col-form-label">Are you sure you want to cancel 
								<strong id="courseName"></strong>?
							</label>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal"> No</button>
							
							<form   id="form" action="#" 
								th:action="@{/enrollment/schedules/{courseScheduleId}/cancel}"  method="post">
								<input type="hidden" name="courseScheduleId" id="id" />
								<button type="submit" name="submit" value="submit" class="btn btn-primary" >Yes</button>
							</form>
							
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--Confirmation Modal End-->
		
		<!--Success Modal-->
		<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm text-center">
				<div class="modal-content">
					<div class="modal-header alert-success">
						<h5 class="modal-title">Success</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="form-group row">
							<label class="col-lg-12 col-form-label" id="successMessage"> <span id="cancelledCourseName"></span></label>
						</div>	
					</div>
				</div>
			</div>
		</div>
		<!--Success Modal End-->	


		<!--Register Modal-->
		
			<div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Course Details</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<div class="form-group row">
								<label class="col-lg-3 col-form-label">Course Schedule ID:</label>
								<div class="col-lg-9">
									<input type="text" class="form-control-plaintext" id="courseRegistrationId"
											 disabled >
								</div>
								<label class="col-lg-3 col-form-label">Course Name:</label>
								<div class="col-lg-9">
									<input type="text" class="form-control-plaintext" id="courseRegistrationName" name="" disabled >
								</div>
								<label class="col-lg-3 col-form-label">Instructor:</label>
								<div class="col-lg-9">
									<input type="text" class="form-control-plaintext" id="courseRegistrationInstructorName"  disabled >
								</div>
								<label class="col-lg-3 col-form-label">Course Date(s):</label>
								<div class="col-lg-9">
									<input type="text" class="form-control-plaintext" id="" value="June 1, 2020"  disabled>
								</div>
								<label class="col-lg-3 col-form-label">Time slot:</label>
								<div class="col-lg-9">
									<input type="text" class="form-control-plaintext" id="" value="8:00 AM to 17:30 PM PHT"  disabled>
								</div>
							</div>
							<div class="alert alert-danger text-center">
								<h5>This is a REQUIRED training</h5>
							</div>	
							<div class="form-group row">
								<label class="col-lg-3 col-form-label">Course Description:</label>
								<div class="col-lg-9">
									<label class="col-form-label">Hello World Hello World Hello World Hello World Hello World Hello World Hello World Hello World Hello World Hello World</label>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<form class="form-horizontal" action="#" 
									th:action="@{/enrollment/schedules/{courseScheduleId}/enroll}" 
									th:object="${courseEnrollmentForm}" method="post">
								<input type="hidden" id="courseScheduleIdHidden" name="courseScheduleId">
								<button type="submit" name="submit" value="submit" class="btn btn-success" onclick="">Register</button>
							</form>
							<input type="button" class="btn btn-danger" data-dismiss="modal" value="Back">
						</div>
					</div>
				</div>
			</div>

		<!--Register Modal End-->
		<!--Confirm Modal-->
		<form class="form-horizontal">
			<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-sm text-center">
					<div class="modal-content">
						
						<div class="modal-body">
							<div class="form-group row">
								<label class="col-lg-12 col-form-label">Are you sure you would like to register to this training?</label>
							</div>	
						</div>
						<div class="modal-footer">
							<input type="submit" class="btn btn-success" value="Yes" name="confirm" data-dismiss="modal">
							<input type="button" class="btn btn-danger" data-dismiss="modal" value="No">
						</div>
					</div>
				</div>
			</div>
		</form>
		<!--Confirm Modal End-->

		<div style="overflow-x:auto;display: block; white-space: nowrap" class="mt-5">
			<h3><i class="fa fa-list"></i> List of Available Trainings</h3>
			<table id="data" class="table table-bordered table-responsive text-center" style="width:100%" 
					th:object="${viewCourseEnroll}">
				<colgroup >
					<col style="width:20%"/>
					<col style="width:20%"/>
					<col style="width:30%"/>
					<col style="width:30%"/>
					<col style="width:10%"/>
					<col style="width:15%"/>
				</colgroup>
				<thead>
					<tr>
						<th>Course ID</th>
						<th>Course Name</th>
						<th>Instructor</th>
						<th>Start Date Time</th>
						<th>End Date Time</th>
						<th>Duration</th>
						<th>Venue</th>
						<th>Minimum Number of Participants</th>
						<th>Maximum Number of Participants</th>
						<th>Total Number of Participants</th>
					
					</tr>
				</thead>
				<tbody th:if="${courseSchedule} != null"
						 th:each="courseSchedule : *{courseSchedules}"
						th:with="courseScheduleDetails = ${courseSchedule.getCourseScheduleDetails()}">
					<tr th:each=" courseScheduleDetail : ${courseScheduleDetails}"
							th:with="courseScheduleId = ${courseSchedule.id}">
						<td th:text="${courseScheduleId}"/>
						<td th:text="${courseSchedule.getCourseName()}" th:with="courseScheduleName = ${courseSchedule.courseName}"/>
						<td th:text="${courseSchedule.instructorName}" th:with="courseScheduleInstructor = ${courseSchedule.instructorName}"/> 
						<td th:text="${courseScheduleDetail.scheduledStartDateTime}" />
						<td th:text="${courseScheduleDetail.scheduledEndDateTime}"/>
						<td th:text="${courseScheduleDetail.duration}"/>
						<td sec:authorize="hasAuthority('PMO')">
						<td th:text="${courseSchedule.venueName}"/>
						<td th:text="${courseSchedule.minRequired}"/>
						<td th:text="${courseSchedule.maxAllowed}"/>
						<td th:text="${courseSchedule.totalParticipants}"/>

						<td sec:authorize="hasAuthority('PMO')">
							<button class="btn btn-danger" name="" th:attr="onclick=|cancellation('${courseScheduleId}','${courseSchedule.courseName}')|" >
								<i class="fa fa-times"></i> Cancel
							</button>
						</td>

						<td sec:authorize="hasAuthority('Member')">
							<form action="#"
									th:action="@{/enrollment/schedules/{courseScheduleId}/enroll (courseScheduleId = ${courseScheduleId})}"
									th:object="${courseEnrollmentForm}" method="get">
								<button th:attr="onclick=|registration('${courseScheduleId}','${courseSchedule.courseName}','${courseSchedule.instructorName}')|" 
										type="button" class="btn btn-success">Register</button>
							</form>
						</td>
					</tr>
				</tbody>
			</table>
		</div>    
		
	</div>
	
	<footer th:replace="fragments/general.html :: footer"></footer>
	
<script th:inline="javascript">
	<!--Message alert-->
	var cancelledCourseName;
	var cancelledCourseId;
	
//	var action !P
	//add if statement for the success/fail messages
// 	$('input[name="error"]').on('click', function() {
// 		$('#errorModal').modal('show');
// 	});
	
// 	$('input[name="success"]').on('click', function() {
// 		$('#successModal').modal('show');
// 	});
	
	
// 	$('button[name="cancellation"]').on('click', function() {
// 		$('#confirmModal').modal('show');
// 	});
	
	<!--Message alert End-->
	//Confirmation
	function cancellation(courseId,courseName){
		cancelledCourseId = courseId;
		cancelledCourseName = courseName;
		$('#confirmModal').modal('show');
		document.getElementById("courseName").innerHTML = cancelledCourseName ;
		var input = document.getElementById("id");
		input.value=courseId
	}

	//SHOW REGISTRATION POP UP
	function registration(courseScheduleId, courseScheduleName, courseScheduleInstructorName){
// 		alert(courseScheduleId + courseScheduleName + courseScheduleInstructorName);
		
		var idInput = document.getElementById('courseRegistrationId');
		idInput.value = courseScheduleId;
		
		var idHiddenInput = document.getElementById('courseScheduleIdHidden');
		idHiddenInput.value = courseScheduleId;
		
		var courseNameInput = document.getElementById('courseRegistrationName');
		courseNameInput.value = courseScheduleName;
		
		var courseInstructorNameInput = document.getElementById('courseRegistrationInstructorName');
		courseInstructorNameInput.value = courseScheduleInstructorName;
		
		$('#registerModal').modal('show');
	}
	//SHOW REGISTRATION POP UP
	
	//SHOW REGISTRATION CONFIRMATION POP UP
	function showRegistrationConfirmation(){
		alert("wat f");
// 		var idInput = document.getElementById('idRegCon');
// 		idInput.value = id;
// 		document.getElementById('courseNameRegCon').innerHTML = name;
// 		$('#registrationConfirmModal').modal('show');
	}
	//SHOW REGISTRATION CONFIRMATION POP UP
	
	//FromDateTime is Higher that ToDateTime
	/*<![CDATA[*/
	var errorMessage = /*[[${error}]]*/ 'default';
	if(errorMessage ==  "To Date should be greater than or equal to From Date"){
		document.getElementById("message").innerHTML = errorMessage;
		$('#errorModal').modal('show');
	}
	/*]]>*/
	
	//Successfuly canceled a Course Schedule
	/*<![CDATA[*/
	var successMessage = /*[[${successMessage}]]*/ 'default';
	if(successMessage == "Successfully Canceled the Course Schedule"){
		document.getElementById("successMessage").innerHTML = successMessage;
		$('#successModal').modal('show');
	}
	/*]]>*/
	
	//No Record Found
	/*<![CDATA[*/
	var nullMessage = /*[[${nullMessage}]]*/ 'default';
	if(nullMessage == "No Record Found"){
		document.getElementById("message").innerHTML = nullMessage;
		$('#errorModal').modal('show');
	}
	/*]]>*/
	
	
	//REGISTRATION START
	//SUCCESS ENROLL
	/*<![CDATA[*/
	var successMsg = /*[[${successMsg}]]*/ 'default';
	if(successMsg == "Successfully Enrolled a Course!!!"){
		document.getElementById("successMessage").innerHTML = successMsg;
		$('#successModal').modal('show');
	}
	/*]]>*/
	
	
	//ERROR ENROLL
	/*<![CDATA[*/
	var errorMsg = /*[[${errorMsg}]]*/ 'default';
	if(errorMsg == "Failed to enroll a course!!!"){
		document.getElementById("message").innerHTML = errorMsg;
		$('#errorModal').modal('show');
	}
	
	/*]]>*/
	
	//REGISTRATION END
</script>

</body>

</html>