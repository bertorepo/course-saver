<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Page of Generate Reports" />
<meta name="author" content=" " />
<title>Generate Reports</title>
<link rel="stylesheet" type="text/css" href="/css/app/bootstrap.min.css">
<link rel="stylesheet" type="text/css"
	href="/css/app/font-awesome.min.css">
<style>
hr {
	margin: 5px;
}
</style>
<script th:src="@{/js/app/jquery-3.5.1.js}"></script>
<script th:src="@{/js/app/bootstrap.min.js}"></script>
<script th:src="@{/js/app/moment.min.js}"></script>
</head>
<body onload="load()">
	<div th:insert="fragments/general.html :: header"></div>
	<div class="container mt-5 div_minheight">
		<h3>
			<i class="fa fa-file-text"></i> Generate Reports
		</h3>
		<hr>
		<form id="mandatoryCourses" class="form-horizontal" action="#"
			th:action="@{/mandatoryCourses/view}" th:object="${mandatoryCourses}"
			method="GET">
			<div class="card">
				<div class="card-body">
					<div class="form-group row align-items-center justify-content-center">
						<label class="col-lg-2 col-form-label" style="font-weight: bold;">Report
							Type</label> <span style="width: 70px"></span>
						<div class="col-lg-5">
							<select id="selectReportType" name="selectReportType"
								class="form-control" required onchange="selectReport()"
								style="width: 525px; text-align-last: center;">
								<option value="" disabled hidden>Please Select Report
									Type</option>
								<option th:value="0" disabled hidden></option>
								<option th:value="1">Summary of Course Conducted</option>
								<option th:value="2" selected>Mandatory Courses
									Conducted</option>
							</select>
						</div>
					</div>
					<div class="form-group row align-items-center justify-content-center">

						<span style="width: 31px"></span> <label
							class="col-lg-3 col-form-label" style="font-weight: bold;">Date
							Range</label> <label class="col-form-label" style="font-weight: bold;">From</label>
						<span style="width: 8px"></span> <input class="form-control"
							type="datetime-local" id="startDate" name="startDate"
							style="width: 220px; font-size: 14px;" onkeydown="return false"
							required /> <input type="hidden" th:field="*{startDateTime}" />

						<!-- INPUT -->

						<!-- INPUT -->

						<span style="width: 8px"></span> <label class="col-form-label"
							style="font-weight: bold;">To</label>

						<div class="col-lg-2">

							<input class="form-control" type="datetime-local" id="endDate"
								name="endDate" style="width: 220px; font-size: 14px;"
								onkeydown="return false" required /> <input type="hidden"
								th:field="*{endDateTime}" />
						</div>

					</div>

					<!-- *************************** COURSE *************************** -->
					<div
						class="form-group row align-items-center justify-content-center">
						<label class="col-lg-2 col-form-label" style="font-weight: bold;">Mandatory
							Course</label> <span style="width: 75px"></span>
						<div class="col-lg-5">
							<input list="course" class="form-control" id="inputCourse"
								type="text" style="width: 525px;" autocomplete="off">
							<datalist id="course">
								<!--<option th:each="courseSelect : *{coursesConductedSet}"
									th:text="${courseSelect.courseName}"
									th:value="${courseSelect.courseName}"
									th:selected="${courseSelect.courseName eq lastSelected}"></option> -->
							</datalist>
						</div>
					</div>

					<!-- *************************** COURSE *************************** -->
					<!-- <div
						class="form-group row align-items-center justify-content-center">
						<label class="col-lg-2 col-form-label" style="font-weight: bold;">Course</label>
						<span style="width: 75px"></span>
						<div class="col-lg-5">
							<input list="course" class="form-control" id="inputCourse"
								type="text" style="width: 525px;" autocomplete="off" disabled>
							<datalist id="course">
								<option th:each="courseSelect : *{coursesConductedSet}"
									th:text="${courseSelect.courseName}"
									th:value="${courseSelect.courseName}"
									th:selected="${courseSelect.courseName eq lastSelected}"></option>
							</datalist>
						</div>
					</div> -->
					<!-- *************************** COURSE *************************** -->


					<div
						class="form-group row align-items-center justify-content-center"
						style="margin-left: 20%">
						<input type="submit" id="viewButton" class="btn btn-success"
							value="View" onclick="btnView()" style="width: 100px"> <span
							style="width: 100px"></span> <input type="button"
							id="exportButton"
							onclick="exportTableToCSV('Summary of Course Conducted.csv')"
							class="btn btn-success" value="Export" style="width: 100px"
							disabled>
					</div>
					<label>Report Display</label>
					<div id="reportTable"
						style="border-style: groove; width: 100%; height: 100%; display: block;">
						<div class="card">
							<div class="row" style="margin: 5px;" >
								<div class="col-sm-4" style="border-style:solid; padding:10px 0px 10px 0px; 
								text-align:center; background-color: #6ad4bf;border-width:2px">
									Total Number of JDU Devs
								</div>
								<div class="col-sm-1" style="border-style:solid; border-width:2px; 
								padding:10px 0px 10px 0px; background-color: #D3D3D3; margin-left:1px;
								text-align:center;" id="totalNumberOfJDUDevs">
									0
								</div>
								<div class="col-sm-6"style="border-style:solid; padding:10px 0px 10px 0px;
								background-color: #6ad4bf;border-width:2px; margin-left:46%; text-align:center;
								position:absolute;">
									Percentage Finished As of Today (Total Members and also Total Courses)
								</div>
							</div>

							<div class="row" style="margin: 5px;">
								<div class="col-sm-4" style="border-style:solid; padding:10px 0px 10px 0px; 
								text-align:center; background-color: #6ad4bf;border-width:2px">
									Total Number of JDU Members Last Week
								</div>
								<div class="col-sm-1" style="border-style:solid; border-width:2px; 
								padding:10px 0px 10px 0px; background-color: #D3D3D3; margin-left:1px;
								text-align:center;" id="totalNumberOfJDUDevsLW">
									0
								</div>
								<div class="col-sm-6 ghost-col"style="border-style:solid; padding:20px 0px 20px 0px;
								background-color: #D3D3D3;border-width:2px; margin-left:46%; text-align:center;
								position:absolute; font-size:270%;" id="percentageFinishedToday">
									0
								</div>
							</div>

							<div class="row" style="margin: 5px;">
								<div class="col-sm-4" style="border-style:solid; padding:10px 0px 10px 0px; 
								text-align:center; background-color: #6ad4bf;border-width:2px">
									Total Number of Existing Members
								</div>
								<div class="col-sm-1" style="border-style:solid; border-width:2px; 
								padding:10px 0px 10px 0px; background-color: #D3D3D3; margin-left:1px;
								text-align:center;" id="totalNumberOfExistingMembers">
									0
								</div>
							</div>

							<div class="row" style="margin: 5px;">
								<div class="col-sm-4" style="border-style:solid; padding:10px 0px 10px 0px; 
								text-align:center; background-color: #6ad4bf;border-width:2px">
									Total Number of New Members
								</div>
								<div class="col-sm-1" style="border-style:solid; border-width:2px; 
								padding:10px 0px 10px 0px; background-color: #D3D3D3; margin-left:1px;
								text-align:center;" id="totalNumberOfNewMembers">
									0
								</div>
								<div class="col-sm-6"style="border-style:solid; padding:10px 0px 10px 0px;
								background-color: #6ad4bf;border-width:2px; margin-left:46%; text-align:center;
								position:absolute;">
									Percentage Finished As of Last Week (Total Members and also Total Courses)
								</div>
							</div>

							<div class="row" style="margin: 5px;">
								<div class="col-sm-4" style="border-style:solid; padding:10px 0px 10px 0px; 
								text-align:center; background-color: #6ad4bf;border-width:2px">
									Total Number of JDU Devs Who Finished the training
								</div>
								<div class="col-sm-1" style="border-style:solid; border-width:2px; 
								padding:10px 0px 10px 0px; background-color: #D3D3D3; margin-left:1px;
								text-align:center;" id="totalNumberOfJDUDevsFinished">
									0
								</div>
								<div class="col-sm-6 ghost-col"style="border-style:solid; padding:20px 0px 20px 0px;
								background-color: #D3D3D3;border-width:2px; margin-left:46%; text-align:center;
								position:absolute; font-size:270%;" id="percentageFinishedToday">
									0
								</div>
							</div>

							<div class="row" style="margin: 5px;">
								<div class="col-sm-4" style="border-style:solid; padding:10px 0px 10px 0px; 
								text-align:center; background-color: #6ad4bf;border-width:2px">
									Total Number of JDU Devs Last Week Who Finished the training
								</div>
								<div class="col-sm-1" style="border-style:solid; border-width:2px; 
								padding:20px 0px 10px 0px; background-color: #D3D3D3; margin-left:1px;
								text-align:center;" id="totalNumberOfJDUDevsFinishedLW">
									0
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
	</div>
	<!--Invalid Modal-->
	<div class="modal fade" id="invalidModal" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-sm text-center">
			<div class="modal-content">
				<div class="modal-header alert-danger">
					<h5 class="modal-title text-white">Invalid Input!</h5>
					<button type="submit" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group row">
						<label class="col-lg-12 col-form-label" id="invalidMsg"></label>
					</div>
					<div class="modal-footer">
						<button class="btn btn-primary" onclick="btnOk()">OK</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--Invalid Modal End-->
	<footer th:replace="fragments/general.html :: footer"></footer>
	<script>
		//-Retrieving data from controller
		/*<![CDATA[*/
		var getTotalNumberOfJduMembers = /*[[${getTotalNumberOfJduMembers}]]*/ 'default';
		/*]]>*/
		/*<![CDATA[*/
		var getTotalNumberOfCompletion = /*[[${getTotalNumberOfCompletion}]]*/ 'default';
		/*]]>*/
		/*<![CDATA[*/
		var getTotalNumberOfCompletionLastWeek = /*[[${getTotalNumberOfCompletionLastWeek}]]*/ 'default';
		/*]]>*/
		/*<![CDATA[*/
		var getPercentageCompletion = /*[[${getPercentageCompletion}]]*/ 'default';
		/*]]>*/
		/*<![CDATA[*/
		var getPercentageCompletionLastWeek = /*[[${getPercentageCompletionLastWeek}]]*/ 'default';
		/*]]>*/
		//-----------------------

		//document.getElementById("#startDateTime").innerHTML = "New text!";

		
		var fromDateTime = $("#startDateTime").val();
		var toDateTime = $("#endDateTime").val();

		var rowCount = $('#summaryCoursesTable tr').length - 1;
		
		function load() {
			console.log("ROW COUNT: " + rowCount);
			if($("#selectReportType").val() == 0 || $("#selectReportType").val() == null){
				$("#exportButton").attr('disabled','disabled');
				$("#viewButton").attr('disabled','disabled');
				$("#inputCourse").attr('disabled','disabled');
			}
			else if(rowCount <= 0)
			{
				$("#inputCourse").attr('disabled','disabled');
				$("#viewButton").removeAttr('disabled');
			}
			else{
				$("#exportButton").removeAttr('disabled'); 
				$("#viewButton").removeAttr('disabled');
				$("#inputCourse").removeAttr('disabled');
			}
 			var fromNewDate = fromDateTime.slice(0, 16);
			var toNewDate = toDateTime.slice(0, 16);
			document.getElementById("startDate").value = fromNewDate;				
			document.getElementById("endDate").value = toNewDate;

			document.getElementById('inputCourse').value;
			
			var selectReportType = document.getElementById("selectReportType").value;
			var showSummaryCourses = document.getElementById("summaryCoursesTable");
			var reportDisplayTable = document.getElementById("reportTable");
			var showMembersCompleted = document.getElementById("summaryMembersTable");
			
			/*if(selectReportType == 1){

				showSummaryCourses.style.display = "block";
				reportDisplayTable.style.display = "none";
				listEmptyMessage.style.display = "block";
			}
			else if(selectReportType == 2){				
				window.location.href = "/mandatoryCourses/load/";
			}
			else{
				window.location.href = "/report/load/";
			}*/
		}
		
		const m = moment();
		 //startDate = document.getElementById("startDate");
		 startDate.max = m.format("YYYY-MM-DDTHH:mm"); 
		 startDate.min = m.format("2017-01-01T00:00");
		 
		 //endDate = document.getElementById("endDate");
		 endDate.max = m.format("YYYY-MM-DDTHH:mm"); 
		 endDate.min = m.format("2017-01-01T00:00");
		 
		 console.log(m.format("YYYY-MM-DDTHH:mm"));
		/**
		Format Date Inputs
		*/
		Date.prototype.toISO = function() {
			return this.getUTCFullYear() +
			'-' + String(this.getUTCMonth() + 1).padStart(2, "0") +
			'-' + String(this.getUTCDate()).padStart(2, "0") +
			'T' + String(this.getUTCHours()).padStart(2, "0") +
			':' + String(this.getUTCMinutes()).padStart(2, "0") +
			':' + String(this.getUTCSeconds()).padStart(2, "0") +
			'.' + (this.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) +
			'Z';
		};
		/**
		For HTML with FromDateTime and ToDateTime
		*/
		$("#startDate").blur(function () {
			var formDate = document.getElementById("startDate").value;
			var newDate = new Date(formDate);
			var dateConcat = newDate.toISO().toString();
			if (formDate == "") {
				$("#startDateTime").prop('value', null);
			} else {
				$("#startDateTime").prop('value', dateConcat);
			}
		}); 
		$("#endDate").blur(function () {
			var formDate = document.getElementById("endDate").value;
			var newDate = new Date(formDate);
			var dateConcat = newDate.toISO().toString(); 
			if (formDate == "") {
				$("#endDateTime").prop('value', null);
			} else {
				$("#endDateTime").prop('value', dateConcat);
			}
		});
		//-----------------------
		/**
		Checking of date range
		*/
		function btnView() {
			var start = document.getElementById("startDateTime").value;
			var end = document.getElementById("endDateTime").value;
			if (start > end) {
				document.getElementById("invalidMsg").innerHTML = "Date Range Invalid."
				$('#invalidModal').modal('show');
			}
		}
		//-----------------------

		/**
		Ok button for invalid modal
		*/
		function btnOk() {
			$('#invalidModal').modal('hide');
		}
		//-----------------------

		/**
		Function for Report Type
		*/
		function selectReport() {
			var selectedReportType = document
					.getElementById("selectReportType").value;

			if (selectedReportType == 1) {
				window.location.href = "/report/course/";
			} else if (selectedReportType == 2) {
				window.location.href = "/mandatoryCourses/load/";
			} else {

			}
		}
		//-----------------------
	</script>
</body>
</html>